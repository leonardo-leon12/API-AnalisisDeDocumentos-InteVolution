<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Conversation Studio</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
        <!-- Bootstrap -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
            crossorigin="anonymous"
        />
        <script
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="/src/styles.css" />
        <link rel="stylesheet" href="/src/stylesConversationAnalisis.css" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
        />
        <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>

    <body>
        <header id="header">
            <a href="https://intevolution.ai/" class="logo-nav">
                <img
                    src="/src/img/logo-intevolution-landscape.svg"
                    alt="logo"
                />
            </a>
            <nav>
                <ul>
                    <li><a href="/">Vision Studio</a></li>
                    <li>
                        <a href="/conversation-analysis.html"
                            >Conversation Studio</a
                        >
                    </li>
                    <li><a href="/assistants.html">Analytics Studio</a></li>
                    <li>
                        <a href="/avatar.html">Avatar Studio</a>
                    </li>
                    <li>
                        <a href="mailto:contacto@intevolution.mx">Contacto</a>
                    </li>
                </ul>
            </nav>
        </header>
        <div class="header-space"></div>
        <img class="separador" src="/src/img/separador.svg" alt="hero" />
        <main>
            <div class="container">
                <div class="row">
                    <div
                        class="col-12 d-flex justify-content-center align-items-center m-2"
                    >
                        <h3>Conversation Studio</h3>
                    </div>

                    <div class="container">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a
                                    class="nav-link active"
                                    id="home-tab"
                                    data-toggle="tab"
                                    href="#home"
                                    role="tab"
                                    aria-controls="home"
                                    aria-selected="true"
                                    >Tabla de conversaciones</a
                                >
                            </li>
                            <li class="nav-item">
                                <a
                                    class="nav-link"
                                    id="report-tab"
                                    data-toggle="tab"
                                    href="#report"
                                    role="tab"
                                    aria-controls="report"
                                    aria-selected="false"
                                    >Reporte de Resultados</a
                                >
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <div
                                class="tab-pane fade show active"
                                id="home"
                                role="tabpanel"
                                aria-labelledby="home-tab"
                            >
                                <div
                                    class="col-12 d-flex justify-content-center align-items-center flex-column m-2"
                                >
                                    <h5>Estado del procesamiento</h5>
                                    <div id="processingStatus"></div>
                                    <span
                                        id="deletionCompleteIcon"
                                        class="material-symbols-outlined d-none"
                                        title="Falta procesar"
                                    >
                                        do_not_disturb_on
                                    </span>
                                    <span
                                        id="CompletedIcon"
                                        class="material-symbols-outlined d-none"
                                    >
                                        check_circle
                                    </span>
                                    <span
                                        id="StatusErrorIcon"
                                        class="material-symbols-outlined d-none"
                                    >
                                        error
                                    </span>
                                    <div
                                        id="InProgressIcon"
                                        class="spinner-border text-primary d-none"
                                        role="status"
                                    >
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                                <div
                                    class="div-process col-12 d-flex justify-content-center align-items-center m-2"
                                >
                                    <button
                                        type="button"
                                        id="btnProcessAudio"
                                        class="refresh-button disabled-button"
                                    >
                                        Procesar
                                    </button>
                                    <button
                                        type="button"
                                        id="btnRefreshAudio"
                                        class="refresh-button"
                                    >
                                        <span class="material-symbols-outlined">
                                            refresh
                                        </span>
                                        Refrescar
                                    </button>
                                    <button
                                        type="button"
                                        id="btnDeleteProcess"
                                        class="refresh-button"
                                    >
                                        <span class="material-symbols-outlined">
                                            delete
                                        </span>
                                        Eliminar procesamiento
                                    </button>
                                    <button
                                        type="button"
                                        class="refresh-button"
                                        data-toggle="modal"
                                        data-target="#exampleModal"
                                        id="btnAddAudio"
                                    >
                                        <span class="material-symbols-outlined">
                                            add
                                        </span>
                                        Agregar audio
                                    </button>
                                </div>
                                <!-- Bootstrap Alert -->
                                <div
                                    id="browser-alert"
                                    class="alert alert-danger mt-3"
                                    role="alert"
                                    style="display: none"
                                >
                                    Tu navegador no soporta la funcionalidad de
                                    grabación de audio. Por favor, utiliza
                                    CHROME
                                </div>
                                <div class="col-12" id="root"></div>
                            </div>
                            <div
                                class="tab-pane fade"
                                id="report"
                                role="tabpanel"
                                aria-labelledby="report-tab"
                            >
                                <div
                                    class="report-tab-container d-flex justify-content-center align-items-center flex-column m-2"
                                >
                                    <h4>Reporte de resultados</h4>
                                    <button
                                        class="refresh-button m-2"
                                        id="refresh-btn-iframe"
                                        style="width: 20%"
                                    >
                                        Actualizar Reporte
                                    </button>
                                    <iframe
                                        class="audio-report-iframe"
                                        id="report-iframe"
                                        allowfullscreen="true"
                                        src="https://app.powerbi.com/view?r=eyJrIjoiNzgxZTM0N2EtMTNjOC00MGQ4LTg5MzQtNDdkYjk2MTViYTNmIiwidCI6IjQ0ZTM0MTMyLTAzNjMtNGZmMi05NjRmLTZkNzgyOWQwYWU5OSIsImMiOjR9&pageName=b3b718d024fdcb79346d"
                                    ></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Loading Modal -->
            <div id="loadingModal" class="modal-loading d-none">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div
                            class="modal-body d-flex align-items-center justify-content-center flex-column"
                        >
                            <div
                                class="spinner-border text-primary"
                                role="status"
                            >
                                <span class="sr-only">Loading...</span>
                            </div>
                            <p>Procesando audio...</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div
                class="modal fade"
                id="exampleModal"
                tabindex="-1"
                role="dialog"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
            >
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div
                                class="d-flex justify-content-between align-items-center"
                            >
                                <h4>Agregar audio</h4>
                                <button
                                    type="button"
                                    class="close btnCloseModal"
                                    data-dismiss="modal"
                                    aria-label="Close"
                                >
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="d-flex">
                                <button id="start-btn" class="mx-1">
                                    Comenzar grabación
                                </button>
                                <button
                                    id="stop-btn"
                                    class="mx-1 disabled-button"
                                    disabled
                                >
                                    Detener grabación
                                </button>
                                <button id="reset-btn" class="mx-1">
                                    Reiniciar
                                </button>
                            </div>
                            <canvas id="waveform" class="mt-3"></canvas>
                            <!-- Playback and Base64 Container -->
                            <div id="audio-playback" class="mt-3"></div>
                            <!-- Transcript Textarea -->
                            <textarea
                                id="transcript"
                                class="form-control mt-3"
                                placeholder="Habla al microfono para ver la transcripción..."
                                rows="3"
                                readonly
                            ></textarea>
                            <div
                                class="d-flex justify-content-center align-items-center"
                            >
                                <button
                                    id="save-btn"
                                    type="button"
                                    id="btnSaveAudio"
                                    onclick="saveAudioToBlob()"
                                >
                                    Guardar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </body>
    <script type="text/babel" src="/src/handleAudioTable.js"></script>
    <script type="text/babel" src="/src/textToSpeech.js"></script>
    <script>
        //Scrolling effect
        let lastScrollTop = 0;
        const header = document.getElementById("header");

        window.addEventListener("scroll", function () {
            let scrollTop =
                window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > lastScrollTop) {
                // Scrolling down
                header.style.top = "-100px"; // Hide the header by moving it off-screen
            } else {
                // Scrolling up
                header.style.top = "0"; // Show the header
            }
            lastScrollTop = scrollTop;
        });

        //Refresh iframe
        document
            .getElementById("refresh-btn-iframe")
            .addEventListener("click", function () {
                var iframe = document.getElementById("report-iframe");
                iframe.src = iframe.src; // This will reload the iframe by reassigning the src attribute
            });
    </script>
</html>
